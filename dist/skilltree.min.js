function namespace(t){for(var n=t.split("."),e=window,i="",o=0,r=n.length;r>o;o++)i=n[o],e[i]=e[i]||{},e=e[i];return e}function prettyJoin(t){return t.length>2&&(t=[t.slice(0,t.length-1).join(", "),t[t.length-1]]),t.join(" and ")}function getInternetExplorerVersion(){var t=-1;if("Microsoft Internet Explorer"==navigator.appName){var n=navigator.userAgent,e=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=e.exec(n)&&(t=parseFloat(RegExp.$1))}return t}function isInvalidIEVersion(){var t=getInternetExplorerVersion();return t>-1&&9>t?($("html").addClass("ltIE9"),!0):!1}ko.bindingHandlers.rightClick={init:function(t,n){$(t).on("mousedown",function(t){3==t.which&&n()()}).on("contextmenu",function(t){t.preventDefault()})}},ko.bindingHandlers.middleClick={init:function(t,n){$(t).on("mousedown",function(t){2==t.which&&n()()})}},function(t){t.fn.konami=function(n,e){return void 0==e&&(e="38,38,40,40,37,39,37,39,66,65"),this.each(function(){var i=[];t(this).keydown(function(o){i.push(o.keyCode),i.toString().indexOf(e)>=0&&(t(this).unbind("keydown",arguments.callee),n(o))})})}}(jQuery);
!function(t,n){!function(e){e.TalentTree=function(e){function o(t){return n.utils.arrayFirst(l.skills(),function(n){return n.id==t})}function r(t){if(t){g=!1,l.newbMode();var e=t.split(d);e[2]&&l.portrait(Number(e[2])),e[3]&&l.avatarName(e[3]);for(var i=e[1],r=[],a=i.split(""),s=0;s<a.length;s++)if(!Number(a[s])){var u=o(a[s].charCodeAt(0)-c);if(u){var p=Number(a[s+1])||1;r.push({skill:u,points:p})}}for(var f=!0;f;)f=!1,n.utils.arrayForEach(r,function(t){!t.wasAllocated&&t.skill.canAddPoints()&&(t.skill.points(Math.min(t.skill.maxPoints,t.points)),t.wasAllocated=!0,f=!0)});g=!0}}function a(){r(f)}function s(t){console.log("updateHash"),window.location.hash=t||m}var u=e||{},l=function(){},c=96,d="_",p=22;l.isOpen=n.observable(!0),l.open=function(){l.isOpen(!0)},l.close=function(){l.isOpen(!1)},l.toggle=function(){l.isOpen(!l.isOpen())},l.skills=n.observableArray(n.utils.arrayMap(u.skills,function(t){return new i(t,l.skills)})),n.utils.arrayForEach(u.skills,function(t){if(t.dependsOn){var e=o(t.id);n.utils.arrayForEach(t.dependsOn,function(t){var n=o(t);e.dependencies.push(n),n.dependents.push(e)})}}),l.avatarName=n.observable("Your Name"),l.level=n.computed(function(){var t=0;return n.utils.arrayForEach(l.skills(),function(n){t+=n.points()}),t+1}),l.noPointsSpent=n.computed(function(){return!Boolean(n.utils.arrayFirst(l.skills(),function(t){return t.points()>0}))}),l.stats=n.computed(function(){var t={Charisma:9,Dexterity:9,Fortitude:9,Intellect:9,Strength:9,Wisdom:9};n.utils.arrayForEach(l.skills(),function(e){var i=e.points();i>0&&n.utils.arrayForEach(e.stats,function(n){var e=t[n.title]||0;e+=n.value*i,t[n.title]=e})});var e=[];for(var i in t)e.push({title:i,value:t[i]});return e}),l.talentSummary=n.computed(function(){var t=[];return n.utils.arrayForEach(l.skills(),function(n){n.hasPoints()&&(t=t.concat(n.talents))}),t.join(", ")}),l.portrait=n.observable(Math.ceil(Math.random()*p)),l.portraitURL=n.computed(function(){return"img/portraits/portrait-"+l.portrait()+".jpg"}),l.choosePreviousPortrait=function(){var t=l.portrait()-1;1>t&&(t=p),l.portrait(t)},l.chooseNextPortrait=function(){var t=l.portrait()+1;t>p&&(t=1),l.portrait(t)},l.newbMode=function(){n.utils.arrayForEach(l.skills(),function(t){t.points(0)})},l.godMode=function(){n.utils.arrayForEach(l.skills(),function(t){t.points(t.maxPoints)})},t(window).konami(function(){l.open(),l.godMode()}),l.hash=n.computed(function(){var t=[];return n.utils.arrayForEach(l.skills(),function(n){n.hasPoints()&&(t.push(String.fromCharCode(n.id+c)),n.hasMultiplePoints()&&t.push(n.points()))}),["",t.join(""),l.portrait(),l.avatarName()].join(d)});var f,h,m,v,g=!0;l.useHash=function(t){f=t,clearTimeout(h),h=setTimeout(a,50)},l.hash.subscribe(function(t){console.log(g),g&&(m=t,clearTimeout(v),v=setTimeout(s,50))}),window.onhashchange=function(){l.useHash(window.location.hash.substr(1))};var w=window.location.hash.substr(1);return l.isOpen(""!=w),l.useHash(w),l};var i=e.Skill=function(t){var e=t||{},i=function(){};return i.id=e.id||0,i.title=e.title||"Unknown Skill",i.description=e.description,i.maxPoints=e.maxPoints||1,i.points=n.observable(e.points||0),i.links=n.utils.arrayMap(e.links,function(t){return new o(t)}),i.dependencies=n.observableArray([]),i.dependents=n.observableArray([]),i.stats=e.stats||[],i.rankDescriptions=e.rankDescriptions||[],i.talents=e.talents||[],i.hasDependencies=n.computed(function(){return i.dependencies().length>0}),i.dependenciesFulfilled=n.computed(function(){var t=!0;return n.utils.arrayForEach(i.dependencies(),function(n){n.hasPoints()||(t=!1)}),t}),i.dependentsUsed=n.computed(function(){var t=!1;return n.utils.arrayForEach(i.dependents(),function(n){n.hasPoints()&&(t=!0)}),t}),i.hasPoints=n.computed(function(){return i.points()>0}),i.hasMultiplePoints=n.computed(function(){return i.points()>1}),i.hasMaxPoints=n.computed(function(){return i.points()>=i.maxPoints}),i.canAddPoints=n.computed(function(){return i.dependenciesFulfilled()&&!i.hasMaxPoints()}),i.canRemovePoints=n.computed(function(){return i.dependentsUsed()&&i.hasMultiplePoints()||!i.dependentsUsed()&&i.hasPoints()}),i.helpMessage=n.computed(function(){if(!i.dependenciesFulfilled()){var t=[];return n.utils.arrayForEach(i.dependencies(),function(n){n.hasMaxPoints()||t.push(n.title)}),"Learn "+prettyJoin(t)+" to unlock."}return""}),i.talentSummary=n.computed(function(){return i.talents.join(", ")}),i.currentRankDescription=n.computed(function(){return i.rankDescriptions[i.points()-1]}),i.nextRankDescription=n.computed(function(){return i.rankDescriptions[i.points()]}),i.addPoint=function(){i.canAddPoints()&&i.points(i.points()+1)},i.removePoint=function(){i.canRemovePoints()&&i.points(i.points()-1)},i},o=e.Link=function(t){var n=t||{},e=function(){};return e.label=n.label||n.url||"Learn more",e.url=n.url||"javascript:void(0)",e}}(namespace("tft.dnd")),t(function(){if(!isInvalidIEVersion()){var e=new tft.dnd.TalentTree(tft.dnd.data);n.applyBindings(e),setTimeout(function(){t(".page").addClass("animated")},50)}})}(window.jQuery,window.ko);
